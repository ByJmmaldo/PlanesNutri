<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>MaldoFit PRO vFinal</title>
<style>
:root {
 --bg:#050505; --card:#141414; --text:#fff; --sub:#888; --border:#333;
 --neon-blue:#00f3ff; --neon-pink:#bc13fe; --neon-green:#0aff60; --neon-red:#ff2a6d; --neon-yellow:#ffd500;
}
body { background:var(--bg); color:var(--text); font-family:-apple-system, system-ui, sans-serif; margin:0; padding:0; padding-bottom:90px; height:100vh; overflow-y:scroll; -webkit-tap-highlight-color:transparent; }
/* HEADER */
.header { position:sticky; top:0; background:rgba(5,5,5,0.95); backdrop-filter:blur(10px); padding:15px 20px; border-bottom:1px solid var(--border); z-index:100; display:flex; justify-content:space-between; align-items:center; }
h1 { margin:0; font-size:22px; font-weight:900; letter-spacing:-0.5px; background:linear-gradient(90deg, var(--neon-blue), var(--neon-pink)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
.btn-obj { background:none; border:1px solid var(--neon-blue); color:var(--neon-blue); padding:5px 12px; border-radius:20px; font-size:11px; font-weight:700; cursor:pointer; }
/* TABS */
.day-scroll { display:flex; overflow-x:auto; padding:15px 20px; gap:8px; scrollbar-width:none; }
.day-pill { background:var(--card); border:1px solid var(--border); padding:8px 16px; border-radius:20px; color:var(--sub); font-size:13px; font-weight:600; white-space:nowrap; transition:0.2s; cursor:pointer; }
.day-pill.active { background:var(--neon-blue); color:#000; border-color:var(--neon-blue); box-shadow:0 0 10px rgba(0,243,255,0.3); }
/* STATS */
.stats { display:grid; grid-template-columns:repeat(4,1fr); gap:8px; padding:0 20px 20px; }
.stat-box { background:var(--card); border:1px solid var(--border); padding:10px 5px; border-radius:10px; text-align:center; }
.s-val { font-size:13px; font-weight:800; display:block; }
.s-lbl { font-size:10px; color:var(--sub); text-transform:uppercase; }
.bar-bg { height:3px; background:#333; margin:5px 5px 0; border-radius:2px; overflow:hidden; }
.bar-fill { height:100%; width:0%; transition:width 0.3s; }
/* LISTS */
.list { padding:0 20px; }
.item { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:15px; margin-bottom:10px; position:relative; animation:fadeIn 0.3s; }
.i-cat { font-size:10px; font-weight:800; color:var(--neon-pink); text-transform:uppercase; margin-bottom:4px; }
.i-name { font-size:15px; font-weight:600; margin-bottom:5px; line-height:1.3; padding-right:30px; }
.i-macro { font-size:11px; color:var(--sub); font-family:monospace; }
.i-ing { font-size:12px; color:#aaa; margin-top:8px; border-top:1px solid #222; padding-top:8px; font-style:italic; }
.btn-act { position:absolute; top:12px; right:12px; width:28px; height:28px; border-radius:50%; border:none; display:flex; align-items:center; justify-content:center; cursor:pointer; font-size:16px; }
.add { background:var(--neon-green); color:#000; }
.del { background:transparent; color:var(--neon-red); font-size:20px; top:10px; }
/* FILTER */
.search-area { padding:0 20px; position:sticky; top:65px; background:var(--bg); z-index:90; padding-bottom:10px; }
.search-inp { width:100%; background:var(--card); border:1px solid var(--border); color:#fff; padding:12px; border-radius:10px; font-size:15px; outline:none; }
.cats { display:flex; gap:8px; overflow-x:auto; margin-top:10px; scrollbar-width:none; padding-bottom:5px; }
.cat-tag { padding:6px 14px; background:#222; border-radius:15px; font-size:12px; color:#aaa; white-space:nowrap; cursor:pointer; border:1px solid transparent; }
.cat-tag.active { background:var(--neon-pink); color:#fff; }
/* MODAL */
#modal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:2000; align-items:center; justify-content:center; backdrop-filter:blur(5px); }
.modal-c { background:var(--card); width:90%; max-width:400px; padding:25px; border-radius:20px; border:1px solid var(--border); max-height:85vh; overflow-y:auto; }
.inp-grp { margin-bottom:15px; }
.inp-lbl { display:block; color:var(--sub); font-size:11px; margin-bottom:5px; text-transform:uppercase; font-weight:700; }
.inp { width:100%; background:#000; border:1px solid var(--border); color:#fff; padding:10px; border-radius:8px; font-size:15px; }
.btn-save { width:100%; background:var(--neon-blue); color:#000; padding:12px; border-radius:8px; border:none; font-weight:800; text-transform:uppercase; margin-top:10px; cursor:pointer; }
.btn-close { width:100%; background:none; border:none; color:var(--sub); padding:10px; margin-top:5px; cursor:pointer; }
/* NAV */
.nav { position:fixed; bottom:0; width:100%; background:rgba(20,20,20,0.95); border-top:1px solid var(--border); display:flex; justify-content:space-around; padding:10px 0 25px; z-index:1000; backdrop-filter:blur(10px); }
.nav-btn { background:none; border:none; color:#555; display:flex; flex-direction:column; align-items:center; gap:4px; font-size:10px; font-weight:600; cursor:pointer; }
.nav-btn.active { color:var(--neon-blue); }
.nav-icon { font-size:20px; }
.view { display:none; } .view.active { display:block; }
@keyframes fadeIn { from{opacity:0;transform:translateY(5px)} to{opacity:1;transform:translateY(0)} }
@media print { .nav, .header, .search-area, .day-scroll, .add { display:none!important; } .view { display:block!important; } body{background:#fff;color:#000;} .item{border:1px solid #ccc; background:#fff; color:#000; break-inside:avoid;} .i-ing{color:#555;} }
</style>
</head>
<body>

<div id="v-home" class="view active">
    <div class="header">
        <h1>MaldoFit</h1>
        <button class="btn-obj" onclick="openModal()">OBJETIVOS</button>
    </div>
    <div class="day-scroll">
        <div class="day-pill active" onclick="setDay('Lunes',this)">Lunes</div>
        <div class="day-pill" onclick="setDay('Martes',this)">Martes</div>
        <div class="day-pill" onclick="setDay('Mi√©rcoles',this)">Mi√©rcoles</div>
        <div class="day-pill" onclick="setDay('Jueves',this)">Jueves</div>
        <div class="day-pill" onclick="setDay('Viernes',this)">Viernes</div>
        <div class="day-pill" onclick="setDay('S√°bado',this)">S√°bado</div>
        <div class="day-pill" onclick="setDay('Domingo',this)">Domingo</div>
    </div>
    <div class="stats">
        <div class="stat-box"><span class="s-val" id="v-k">0</span><span class="s-lbl">Kcal</span><div class="bar-bg"><div id="b-k" class="bar-fill" style="background:#fff"></div></div></div>
        <div class="stat-box"><span class="s-val" id="v-p">0</span><span class="s-lbl">Prot</span><div class="bar-bg"><div id="b-p" class="bar-fill" style="background:var(--neon-red)"></div></div></div>
        <div class="stat-box"><span class="s-val" id="v-c">0</span><span class="s-lbl">Carb</span><div class="bar-bg"><div id="b-c" class="bar-fill" style="background:var(--neon-yellow)"></div></div></div>
        <div class="stat-box"><span class="s-val" id="v-f">0</span><span class="s-lbl">Grasa</span><div class="bar-bg"><div id="b-f" class="bar-fill" style="background:var(--neon-green)"></div></div></div>
    </div>
    <div id="list-plan" class="list"></div>
</div>

<div id="v-lib" class="view">
    <div class="header"><h1>Alimentos</h1></div>
    <div class="search-area">
        <input type="text" id="search" class="search-inp" placeholder="Buscar plato..." onkeyup="renderLib()">
        <div class="cats">
            <div class="cat-tag active" onclick="setCat('Desayuno',this)">Desayuno</div>
            <div class="cat-tag" onclick="setCat('Tentempi√©',this)">Media Ma√±ana</div>
            <div class="cat-tag" onclick="setCat('Comida',this)">Comida</div>
            <div class="cat-tag" onclick="setCat('Merienda',this)">Merienda</div>
            <div class="cat-tag" onclick="setCat('Cena',this)">Cena</div>
        </div>
    </div>
    <div id="list-lib" class="list" style="padding-bottom:100px"></div>
</div>

<div id="modal">
    <div class="modal-c">
        <h2 style="color:var(--neon-blue);margin-top:0">Configuraci√≥n</h2>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
            <div class="inp-grp"><label class="inp-lbl">Peso</label><input type="number" id="w" class="inp" value="80"></div>
            <div class="inp-grp"><label class="inp-lbl">Altura</label><input type="number" id="h" class="inp" value="180"></div>
            <div class="inp-grp"><label class="inp-lbl">Edad</label><input type="number" id="a" class="inp" value="30"></div>
            <div class="inp-grp"><label class="inp-lbl">Sexo</label><select id="s" class="inp"><option value="m">H</option><option value="f">M</option></select></div>
        </div>
        <div class="inp-grp"><label class="inp-lbl">Actividad</label>
            <select id="act" class="inp">
                <option value="1.2">Sedentario</option>
                <option value="1.375">Ligero</option>
                <option value="1.55" selected>CrossFit (3-5 d√≠as)</option>
                <option value="1.725">Alto</option>
                <option value="1.9">Pro</option>
            </select>
        </div>
        <div class="inp-grp"><label class="inp-lbl">Objetivo</label>
            <select id="goal" class="inp" style="border-color:var(--neon-pink)">
                <option value="-0.2">Definici√≥n Agresiva (-20%)</option>
                <option value="-0.1">Definici√≥n Moderada (-10%)</option>
                <option value="0">Mantenimiento</option>
                <option value="0.1">Volumen Limpio (+10%)</option>
                <option value="0.2">Volumen Agresivo (+20%)</option>
            </select>
        </div>
        <button class="btn-save" onclick="calc()">Calcular y Guardar</button>
        <button class="btn-close" onclick="document.getElementById('modal').style.display='none'">Cerrar</button>
    </div>
</div>

<div class="nav">
    <button class="nav-btn active" onclick="go('v-home',this)"><span class="nav-icon">üìÖ</span>Plan</button>
    <button class="nav-btn" onclick="go('v-lib',this)"><span class="nav-icon">üçî</span>Alimentos</button>
    <button class="nav-btn" onclick="window.print()"><span class="nav-icon">üñ®Ô∏è</span>PDF</button>
</div>

<script>
// DATOS COMPRIMIDOS (Para evitar errores de corte)
const db = [
{i:1,t:"Desayuno",n:"Desayuno Completo Pavo",k:781,p:30,c:120,f:20,d:"Leche (150g), Pan (100g), Pavo (45g), Queso (45g), Pl√°tano (125g)"},
{i:7,t:"Desayuno",n:"Bebida Avena y Tostada",k:530,p:20,c:80,f:15,d:"Bebida avena (300g), Pan integral (100g), Pavo (45g), Aceite (8g)"},
{i:21,t:"Desayuno",n:"Pan Integral Almendras",k:657,p:26,c:95,f:21,d:"Leche (225g), Bebida almendras (225g), Pan (70g), Pavo (30g)"},
{i:40,t:"Desayuno",n:"Tortitas Avena Claras",k:557,p:27,c:66,f:21,d:"Claras (105g), Avena (30g), Miel (10g), Nueces (15g)"},
{i:76,t:"Desayuno",n:"Bowl Avena y Yogur",k:693,p:27,c:84,f:28,d:"Leche (150g), Yogur (250g), Avena (60g), Chocolate (40g)"},
{i:91,t:"Desayuno",n:"Porridge de avena",k:330,p:12,c:55,f:6,d:"Leche desnatada (250g), Avena (50g), Canela"},
{i:1001,t:"Desayuno",n:"Tortilla 4 Huevos Jam√≥n",k:450,p:35,c:5,f:30,d:"Huevos (4), Jam√≥n cocido (40g), Queso (30g), Pan blanco (2 reb)"},
{id:1002,t:"Desayuno",n:"Ricotta con Mango",k:380,p:25,c:30,f:18,d:"Queso Ricotta (150g), Mango (100g), Prote√≠na (15g), Pistachos (30g)"},
{id:1003,t:"Desayuno",n:"Pan Jam√≥n y Queso",k:320,p:15,c:40,f:10,d:"Pan blanco (2 reb), Jam√≥n cocido (40g), Queso (30g)"},
{i:2,t:"Tentempi√©",n:"Yogur Griego Granada",k:335,p:11,c:46,f:14,d:"Yogur griego (125g), Avellana (15g), Granada (200g)"},
{i:8,t:"Tentempi√©",n:"Bocadillo Bonito",k:305,p:20,c:37,f:7,d:"Pan (70g), Bonito (55g), Tomate (90g)"},
{i:12,t:"Tentempi√©",n:"Bocadillo Sardinas",k:325,p:18,c:37,f:10,d:"Pan (70g), Sardinas (60g), Tomate (30g)"},
{i:33,t:"Tentempi√©",n:"Tortitas Arroz Guacamole",k:280,p:12,c:35,f:9,d:"Tortitas (30g), Guacamole (30g), Jam√≥n (50g)"},
{id:1004,t:"Tentempi√©",n:"Papilla Arroz Prote√≠na",k:380,p:30,c:60,f:2,d:"Harina arroz (70g), Prote√≠na (30g), Miel (20g), Ar√°ndanos"},
{i:3,t:"Comida",n:"Alubias con acelgas",k:329,p:16,c:52,f:6,d:"Alubias (210g), Patata (100g), Acelgas (100g)"},
{i:4,t:"Comida",n:"Pollo asado",k:510,p:60,c:6,f:27,d:"Pollo asado (300g)"},
{i:9,t:"Comida",n:"Espaguetis con Pavo",k:460,p:35,c:65,f:3,d:"Espagueti (80g), Yogur (125g), Pavo (120g)"},
{i:10,t:"Comida",n:"Salm√≥n y zanahoria",k:505,p:36,c:16,f:32,d:"Salm√≥n (170g), Zanahoria (80g), Ma√≠z (50g)"},
{i:13,t:"Comida",n:"Lentejas con Pimiento",k:288,p:15,c:50,f:5,d:"Lentejas (200g), Pimiento (150g)"},
{i:17,t:"Comida",n:"Arroz con Anchoas",k:378,p:14,c:44,f:12,d:"Arroz (125g), Anchoas (20g), Nueces (15g)"},
{id:1006,t:"Comida",n:"Pollo con Almendras",k:550,p:45,c:20,f:30,d:"Pollo (200g), Almendras (50g), Zanahoria (100g), Pan (40g)"},
{id:1007,t:"Comida",n:"Ensalada Pasta Langostino",k:420,p:30,c:55,f:10,d:"Pasta ma√≠z (40g), Langostinos (50g), Huevos (3)"},
{id:1008,t:"Comida",n:"Patata Asada Ternera",k:600,p:40,c:60,f:20,d:"Patata asada (300g), Ternera (180g), Aguacate (1)"},
{i:5,t:"Merienda",n:"Pan Centeno y Hummus",k:192,p:6,c:37,f:2,d:"Pan centeno (40g), Hummus (15g), Naranja (130g)"},
{i:6,t:"Merienda",n:"Bocadillo Pavo Tomate",k:129,p:7,c:21,f:1,d:"Pan (40g), Tomate (45g), Pavo (15g)"},
{i:19,t:"Merienda",n:"Bocadillo Salm√≥n",k:322,p:15,c:40,f:8,d:"Pan (70g), Salm√≥n ahumado (30g), Tomate (90g)"},
{i:31,t:"Merienda",n:"Pl√°tano",k:178,p:2,c:46,f:0,d:"Pl√°tano (200g)"},
{id:1005,t:"Merienda",n:"Pur√© Verduras Boquer√≥n",k:350,p:25,c:30,f:15,d:"Pur√©, Pan (80g), Boquerones (60g), Queso fresco (200g)"},
{i:7,t:"Cena",n:"Tortilla espinacas",k:166,p:13,c:2,f:11,d:"Claras (35g), Huevo (60g), Espinaca (50g), Queso (62g)"},
{i:11,t:"Cena",n:"At√∫n plancha berenjena",k:276,p:43,c:9,f:6,d:"At√∫n (150g), Berenjena (150g)"},
{i:16,t:"Cena",n:"Lenguado con Br√≥coli",k:329,p:52,c:8,f:10,d:"Lenguado (270g), Br√≥coli (125g)"},
{i:20,t:"Cena",n:"Tortilla francesa",k:229,p:14,c:2,f:18,d:"Huevo (60g), Aceitunas (20g), Tomate (150g)"},
{id:1010,t:"Cena",n:"Sepia plancha con Arroz",k:420,p:35,c:45,f:8,d:"Sepia (200g), Arroz (60g), Verduras"},
{id:1011,t:"Cena",n:"At√∫n horno y Boniato",k:350,p:30,c:35,f:10,d:"At√∫n fresco (150g), Boniato (150g)"},
{i:22,t:"Comida",n:"Macarrones con Tomate",k:450,p:25,c:70,f:5,d:"Macarrones (90g), Tomate frito (60g), At√∫n (60g)"},
{i:25,t:"Comida",n:"Arroz con Surimi",k:350,p:10,c:40,f:14,d:"Arroz (125g), Surimi (60g), Aguacate (40g)"},
{i:29,t:"Comida",n:"Garbanzos con At√∫n",k:606,p:50,c:64,f:17,d:"Garbanzos (200g), At√∫n (110g), Tomate (150g)"},
{i:55,t:"Comida",n:"Espaguetis Pimienta",k:350,p:10,c:60,f:8,d:"Espagueti (80g), Aceite (5g), Ajo, Tomate (50g)"},
{i:73,t:"Comida",n:"Pollo al ajillo",k:502,p:25,c:22,f:30,d:"Pollo (150g), Yogur (125g)"},
{i:83,t:"Comida",n:"Arroz 3 delicias Salm√≥n",k:647,p:41,c:43,f:32,d:"Arroz (125g), Salm√≥n (170g)"},
{i:109,t:"Merienda",n:"Queso batido y nueces",k:180,p:12,c:8,f:10,d:"Queso batido (150g), Nueces (10g)"},
{i:28,t:"Cena",n:"Caballa con Can√≥nigos",k:383,p:30,c:6,f:26,d:"Caballa (150g), Can√≥nigos (30g), Ma√≠z (30g)"},
{i:32,t:"Cena",n:"Huevos con Jam√≥n",k:658,p:49,c:35,f:35,d:"Huevo (120g), Jam√≥n (90g), Pan (70g)"},
{i:63,t:"Cena",n:"Tortilla calabac√≠n",k:257,p:20,c:5,f:16,d:"Huevo (60g), Calabac√≠n (125g), Claras (105g)"},
{i:104,t:"Cena",n:"Crema calabac√≠n y pavo",k:280,p:20,c:20,f:10,d:"Calabac√≠n (200g), Patata (50g), Pavo (100g)"}
];

let state = { day:'Lunes', cat:'Desayuno', plan:{}, targets:{} };
const days = ["Lunes","Martes","Mi√©rcoles","Jueves","Viernes","S√°bado","Domingo"];

function init() {
    // Inicializar plan vac√≠o si no existe
    days.forEach(d => { if(!state.plan[d]) state.plan[d] = []; });
    
    // Cargar localStorage
    try {
        const t = localStorage.getItem('mf_targets');
        const p = localStorage.getItem('mf_plan');
        if(t) state.targets = JSON.parse(t); else calc();
        if(p) state.plan = JSON.parse(p);
    } catch(e) { calc(); }
    
    renderLib();
    renderPlan();
}

function calc() {
    const w = parseFloat(document.getElementById('w').value);
    const h = parseFloat(document.getElementById('h').value);
    const a = parseFloat(document.getElementById('a').value);
    const s = document.getElementById('s').value;
    const act = parseFloat(document.getElementById('act').value);
    const goal = parseFloat(document.getElementById('goal').value);

    let bmr = (s === 'm') ? 88.362 + (13.397*w) + (4.799*h) - (5.677*a) : 447.593 + (9.247*w) + (3.098*h) - (4.330*a);
    const tdee = bmr * act;
    const k = Math.round(tdee * (1 + goal));
    const p = Math.round(w * 2);
    const f = Math.round(w * 0.9);
    const c = Math.round((k - (p*4 + f*9)) / 4);

    days.forEach(d => state.targets[d] = { k, p, c, f });
    localStorage.setItem('mf_targets', JSON.stringify(state.targets));
    
    document.getElementById('modal').style.display='none';
    renderPlan();
}

function setDay(d, el) {
    state.day = d;
    document.querySelectorAll('.day-pill').forEach(e => e.classList.remove('active'));
    el.classList.add('active');
    renderPlan();
}

function setCat(c, el) {
    state.cat = c;
    document.querySelectorAll('.cat-tag').forEach(e => e.classList.remove('active'));
    el.classList.add('active');
    renderLib();
}

function renderLib() {
    const list = document.getElementById('list-lib');
    const term = document.getElementById('search').value.toLowerCase();
    list.innerHTML = '';

    const filtered = db.filter(x => {
        let match = x.t === state.cat;
        if(state.cat === 'Tentempi√©' && (x.t === 'M.MA√ëANA' || x.t === 'Media Ma√±ana')) match = true;
        return match && (x.n.toLowerCase().includes(term) || x.d.toLowerCase().includes(term));
    });

    filtered.forEach(x => {
        list.innerHTML += `
            <div class="item">
                <div class="i-cat">${x.t}</div>
                <div class="i-name">${x.n}</div>
                <div class="i-macro">üî•${x.k} ¬∑ P${x.p} ¬∑ C${x.c} ¬∑ G${x.f}</div>
                <div class="i-ing">${x.d}</div>
                <button class="btn-act add" onclick="add(${x.i})">+</button>
            </div>
        `;
    });
}

function add(id) {
    const item = db.find(x => x.i === id);
    state.plan[state.day].push(item);
    save(); renderPlan();
}

function del(idx) {
    state.plan[state.day].splice(idx, 1);
    save(); renderPlan();
}

function save() { localStorage.setItem('mf_plan', JSON.stringify(state.plan)); }

function renderPlan() {
    const list = document.getElementById('list-plan');
    list.innerHTML = '';
    let tot = {k:0,p:0,c:0,f:0};

    if(state.plan[state.day]) {
        state.plan[state.day].forEach((x, idx) => {
            tot.k += x.k; tot.p += x.p; tot.c += x.c; tot.f += x.f;
            list.innerHTML += `
                <div class="item">
                    <div class="i-cat">${x.t}</div>
                    <div class="i-name">${x.n}</div>
                    <div class="i-macro">üî•${x.k} ¬∑ P${x.p} ¬∑ C${x.c} ¬∑ G${x.f}</div>
                    <button class="btn-act del" onclick="del(${idx})">√ó</button>
                </div>
            `;
        });
    }

    const tgt = state.targets[state.day] || {k:2500,p:160,c:300,f:70};
    
    updateBar('k', tot.k, tgt.k);
    updateBar('p', tot.p, tgt.p);
    updateBar('c', tot.c, tgt.c);
    updateBar('f', tot.f, tgt.f);
}

function updateBar(key, val, max) {
    document.getElementById('v-'+key).innerText = `${val} / ${max}`;
    document.getElementById('b-'+key).style.width = Math.min((val/max)*100, 100) + '%';
}

function go(view, el) {
    document.querySelectorAll('.view').forEach(e => e.classList.remove('active'));
    document.getElementById(view).classList.add('active');
    document.querySelectorAll('.nav-btn').forEach(e => e.classList.remove('active'));
    el.classList.add('active');
}

function openModal() { document.getElementById('modal').style.display = 'flex'; }

// START
init();
</script>
</body>
</html>
